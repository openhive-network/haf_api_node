{
  "limits": {
    // reject broadcast_transaction calls with custom_json ops from these accounts.
    // "non-steemit" is not a real account on the blockchain, I think this is just there
    // to suppress a "using empty accounts_blacklist" warning message, we're really
    // not blacklisting anything here
    "accounts_blacklist": ["non-steemit"]
  },
  "upstreams": [
    // the "upstreams" part of the config is a list of NAMESPACEs
    //
    // Request processing works like this:
    // - figure out the method's real [namespace, API, method], and params:
    //   it will either be in the form:
    //   - foo
    //     if foo is "call": 
    //       if params are [bar, baz]: ["appbase", bar, baz]
    //       if params are [bar, baz, [...] or {...}]: ["appbase", bar, baz] or ["hived", bar, baz], depending
    //     otherwise: ["hived", "database_api", foo]
    //   - foo.bar
    //     if foo ends in "_api": ["appbase", foo, bar]
    //     if foo is"jsonrpc": ["appbase", "jsonrpc", bar]
    //     otherwise: [foo, null, bar]
    //   - foo.bar.baz: [foo, bar, baz]
    // - if the API is numeric, do a lookup to find out the symbolic API name
    //
    // Now, we lookup the upstream URL, TTL, and timeout using the [namespace, api, method].
    // This match finds the longest matching prefix across all of the upstreams in the config.
    // It is entirely possible that it will match a upstream URL from one "upstream" block,
    // the TTL from a second, and the timeout from a third.
    //
    // Next, we lookup whether we should "translate_to_appbase" by matching the namespace
    // we've detected with the "name" of an upstream.  Translate_to_appbase will convert
    // our [namespace, api, method] and params into an un-parsed JSON-RPC call that looks like:
    //    { "jsonrpc": "2.0", "id": 1, "method": "call", "params": ["condenser_api", method, params] }
    // This json-rpc call is now re-parsed, starting at the top (this re-parsing only happens once,
    // it will never loop, even if the re-parsed call ends up in a namespace that also has 
    // translate_to_appbase: true)
    {
      "name": "hived",
      "translate_to_appbase": true,
      // The "urls", "ttls", and "timeouts" sections are maps from the API call name to
      // "urls": the backend that should handle this request
      // "ttls": the TTL for caching this request
      // "timeouts": how long we should allow the backend to generate the reply
      // 
      // In all three sections, we take the most specific match (the longest matching prefix),
      // the order they appear in the file isn't relevant.
      //
      // 
      "urls": [
        [
          "hived",
          "ws://haproxy:7001"
        ],
        [
          "hived.network_broadcast_api.broadcast_transaction_synchronous",
          "http://haproxy:7006"
        ]
      ],
      "ttls": [
        [
          "hived",
          3
        ],
        [
          "hived.login_api",
          -1
        ],
        [
          "hived.network_broadcast_api",
          -1
        ],
        [
          "hived.follow_api",
          10
        ],
        [
          "hived.market_history_api",
          1
        ],
        [
          "hived.database_api",
          3
        ],
        [
          "hived.database_api.get_block",
          -2
        ],
        [
          "hived.database_api.get_block_header",
          -2
        ],
        [
          "hived.database_api.get_content",
          1
        ],
        [
          "hived.database_api.get_state",
          1
        ],
        [
          "hived.database_api.get_state.params=['/trending']",
          30
        ],
        [
          "hived.database_api.get_state.params=['trending']",
          30
        ],
        [
          "hived.database_api.get_state.params=['/hot']",
          30
        ],
        [
          "hived.database_api.get_state.params=['/welcome']",
          30
        ],
        [
          "hived.database_api.get_state.params=['/promoted']",
          30
        ],
        [
          "hived.database_api.get_state.params=['/created']",
          10
        ],
        [
          "hived.database_api.get_dynamic_global_properties",
          1
        ]
      ],
      "timeouts": [
        [
          "hived",
          5
        ],
        [
          "hived.network_broadcast_api",
          0
        ]
      ]
    },
    {
      "name": "appbase",
      "urls": [
        [
          "appbase.condenser_api.get_account_reputations",
          "http://haproxy:7002"
        ],
        [
          "appbase.follow_api.get_account_reputations",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_accounts",
          "ws://haproxy:7001"
        ],
        [
          "appbase.condenser_api.broadcast_block",
          "ws://haproxy:7001"
        ],
        [
          "appbase.condenser_api.broadcast_transaction",
          "ws://haproxy:7001"
        ],
        [
          "appbase.condenser_api.broadcast_transaction_synchronous",
          "http://haproxy:7006"
        ],
        [
          "appbase.network_broadcast_api.broadcast_transaction_synchronous",
          "http://haproxy:7006"
        ],
        [
          "appbase.network_broadcast_api",
          "ws://haproxy:7001"
        ],
        [
          "appbase.condenser_api.get_block",
          "ws://haproxy:7001"
        ],
        [
          "appbase.block_api.get_block",
          "http://haproxy:7003"
        ],
        [
          "appbase.block_api.get_block_header",
          "http://haproxy:7003"
        ],
        [
          "appbase.block_api.get_block_range",
          "http://haproxy:7003"
        ],
        [
          "appbase.account_history_api.get_account_history",
          "http://haproxy:7003"
        ],
        [
          "appbase.account_history_api.get_ops_in_block",
          "http://haproxy:7003"
        ],
        [
          "appbase.account_history_api.enum_virtual_ops",
          "http://haproxy:7003"
        ],
        [
          "appbase.account_history_api.get_transaction",
          "http://haproxy:7003"
        ],
        [
          "appbase.condenser_api.get_account_history",
          "http://haproxy:7003"
        ],
        [
          "appbase.condenser_api.get_ops_in_block",
          "http://haproxy:7003"
        ],
        [
          "appbase.condenser_api.enum_virtual_ops",
          "http://haproxy:7003"
        ],
        [
          "appbase.condenser_api.get_transaction",
          "http://haproxy:7003"
        ],
        [
          "appbase.condenser_api.get_active_votes",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_blog",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_blog_entries",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_comment_discussions_by_payout",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_content",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_content_replies",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_discussions_by_author_before_date",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_discussions_by_blog",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_discussions_by_comments",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_discussions_by_created",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_discussions_by_feed",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_discussions_by_hot",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_discussions_by_promoted",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_discussions_by_trending",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_follow_count",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_followers",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_following",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_post_discussions_by_payout",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_reblogged_by",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_replies_by_last_update",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_trending_tags",
          "http://haproxy:7002"
        ],
        [
          "appbase.database_api.list_comments",
          "http://haproxy:7002"
        ],
        [
          "appbase.database_api.list_votes",
          "http://haproxy:7002"
        ],
        [
          "appbase.database_api.find_votes",
          "http://haproxy:7002"
        ],
        [
          "appbase.database_api.find_comments",
          "http://haproxy:7002"
        ],
        [
          "appbase.tags_api.get_discussion",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_state.params=['witnesses']",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_state.params=['/witnesses']",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_state.params=['/~witnesses']",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_state.params=['~witnesses']",
          "http://haproxy:7002"
        ],
        [
          "appbase.condenser_api.get_state",
          "http://haproxy:7002"
        ],
        [
          "appbase",
          "ws://haproxy:7001"
        ]
      ],
      "ttls": [
        [
          "appbase",
          1
        ],
        [
          "appbase.block_api",
          -2
        ],
        [
          "appbase.block_api.get_block_range",
          -1
        ],
        [
          "appbase.database_api",
          1
        ],
        [
          "appbase.condenser_api.get_account_reputations",
          3600
        ],
        [
          "appbase.condenser_api.get_block",
          -2
        ],
        [
          "appbase.condenser_api.get_ticker",
          1
        ],
        [
          "appbase.condenser_api.get_accounts",
          6
        ],
        [
          "appbase.condenser_api.get_account_history",
          6
        ],
        [
          "appbase.condenser_api.get_content",
          6
        ],
        [
          "appbase.condenser_api.get_profile",
          6
        ],
        [
          "appbase.database_api.find_accounts",
          3
        ],
        [
          "appbase.condenser_api.get_dynamic_global_properties",
          1
        ]
      ],
      "timeouts": [
        [
          "appbase",
          3
        ],
        [
          "appbase.chain_api.push_block",
          0
        ],
        [
          "appbase.chain_api.push_transaction",
          0
        ],
        [
          "appbase.network_broadcast_api",
          0
        ],
        [
          "appbase.condenser_api.broadcast_block",
          0
        ],
        [
          "appbase.condenser_api.broadcast_transaction",
          0
        ],
        [
          "appbase.condenser_api.broadcast_transaction_synchronous",
          0
        ],
        [
          "appbase.condenser_api.get_ops_in_block.params=[2889020,false]",
          20
        ]
      ]
    },
    {
      "name": "hive",
      "translate_to_appbase": false,
      "urls": [
        [
          "hive",
          "http://haproxy:7002"
        ]
      ],
      "ttls": [
        [
          "hive",
          -1
        ]
      ],
      "timeouts": [
        [
          "hive",
          30
        ]
      ]
    },
    {
      "name": "bridge",
      "translate_to_appbase": false,
      "urls": [
        [
          "bridge",
          "http://haproxy:7002"
        ]
      ],
      "ttls": [
        [
          "bridge",
          -1
        ],
        [
          "bridge.get_discussion",
          6
        ],
        [
          "bridge.get_account_posts",
          12
        ],
        [
          "bridge.get_ranked_posts",
          6
        ],
        [
          "bridge.get_profile",
          6
        ],
        [
          "bridge.get_community",
          6
        ],
        [
          "bridge.get_post",
          6
        ],
        [
          "bridge.get_trending_topics",
          3
        ]
      ],
      "timeouts": [
        [
          "bridge",
          30
        ]
      ]
    },
    {
      "name": "hafsql",
      "translate_to_appbase": false,
      "urls": [
        [
          "hafsql-api",
          "http://haproxy:7007"
        ]
      ],
      "ttls": [
        [
          "hafsql",
          -1
        ]
      ],
      "timeouts": [
        [
          "hafsql",
          30
        ]
      ]
    }
  ]
}
