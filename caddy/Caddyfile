# Simple caddy config, handles SSL and forwards everything to varnish
{$PUBLIC_HOSTNAME} {
  # Import a snippet that will generate a self-signed certificate by default.
  # To generate a real certificate, bind-mount an empty file here and then
  # put your real TLS config in a file in the snippets directory
  import tls-self-signed-snippets/*.snippet

  import snippets/*.snippet

  # Route all POST calls to the root URL to jussi (assume they're old-style JSON-RPC calls)
  @post_to_root {
    method POST
    path /
  }
  reverse_proxy @post_to_root http://jussi:9000

  # Route everything else (mostly new-style REST calls)
  reverse_proxy http://varnish
}
